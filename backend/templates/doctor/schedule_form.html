{% extends "base.html" %}

{% block title %}{{ '编辑排班' if schedule else '添加排班' }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h4>{{ '编辑排班' if schedule else '添加排班' }}</h4>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="form-group mb-3">
                            <label for="doctor_id">医生 <span class="text-danger">*</span></label>
                            <select class="form-control" id="doctor_id" name="doctor_id" required>
                                <option value="">请选择医生</option>
                                {% for doctor in doctors %}
                                <option value="{{ doctor.id }}" 
                                        {{ 'selected' if schedule and schedule.doctor_id == doctor.id else '' }}>
                                    {{ doctor.name }} - {{ doctor.department }} - {{ doctor.title }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="date">日期 <span class="text-danger">*</span></label>
                                    <input type="date" class="form-control" id="date" name="date" 
                                           value="{{ schedule.date if schedule else '' }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>班次 <span class="text-danger">*</span></label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="shift" id="shift_morning" 
                                                   value="morning" {{ 'checked' if (schedule and schedule.shift == 'morning') or not schedule else '' }} required>
                                            <label class="form-check-label" for="shift_morning">上午班</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="shift" id="shift_afternoon" 
                                                   value="afternoon" {{ 'checked' if schedule and schedule.shift == 'afternoon' else '' }}>
                                            <label class="form-check-label" for="shift_afternoon">下午班</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="shift" id="shift_evening" 
                                                   value="evening" {{ 'checked' if schedule and schedule.shift == 'evening' else '' }}>
                                            <label class="form-check-label" for="shift_evening">夜班</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="start_time">开始时间</label>
                                    <input type="time" class="form-control" id="start_time" name="start_time" 
                                           value="{{ schedule.start_time if schedule else '' }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="end_time">结束时间</label>
                                    <input type="time" class="form-control" id="end_time" name="end_time" 
                                           value="{{ schedule.end_time if schedule else '' }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="max_patients">最大接诊数</label>
                                    <input type="number" class="form-control" id="max_patients" name="max_patients" 
                                           value="{{ schedule.max_patients if schedule else '20' }}" min="1" max="100">
                                </div>
                            </div>
                        </div>

                        {% if schedule %}
                        <div class="form-group mb-3">
                            <label>状态</label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="status" id="status_available" 
                                           value="available" {{ 'checked' if schedule.status == 'available' else '' }}>
                                    <label class="form-check-label" for="status_available">可预约</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="status" id="status_full" 
                                           value="full" {{ 'checked' if schedule.status == 'full' else '' }}>
                                    <label class="form-check-label" for="status_full">已满</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="status" id="status_cancelled" 
                                           value="cancelled" {{ 'checked' if schedule.status == 'cancelled' else '' }}>
                                    <label class="form-check-label" for="status_cancelled">已取消</label>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <div class="form-group mb-3">
                            <label for="notes">备注</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3">{{ schedule.notes if schedule else '' }}</textarea>
                        </div>

                        <div class="form-group mt-4">
                            <button type="submit" class="btn btn-primary">保存</button>
                            <a href="{{ url_for('doctor.schedule_list') }}" class="btn btn-secondary">取消</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

